<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Factura</title>

<style>
body {
    font-family: Arial, sans-serif;
    display: flex;
    justify-content: center;
    padding: 20px;
}

.factura {
    width: 850px;
    border: 2px solid #1c3faa;
    padding: 15px;
}

.header {
    display: flex;
    justify-content: space-between;
    border-bottom: 2px solid #1c3faa;
    padding-bottom: 10px;
}

.titulo {
    text-align: center;
    flex: 1;
}

.titulo h1 {
    margin: 0;
    color: #1c3faa;
}

.tipo-doc {
    width: 180px;
    text-align: left;
}

.numero {
    color: red;
    font-weight: bold;
    margin-top: 5px;
}

.numero input {
    width: 70px;
    border: none;
    border-bottom: 1px solid red;
    color: red;
    font-weight: bold;
    text-align: center;
}

.info {
    display: flex;
    justify-content: space-between;
    margin-top: 15px;
}

.campo {
    margin-bottom: 8px;
}

.campo label {
    display: inline-block;
    width: 110px;
    font-weight: bold;
}

.campo input {
    border: none;
    border-bottom: 1px solid black;
    width: 200px;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}

th, td {
    border: 1px solid #1c3faa;
    padding: 5px;
    text-align: center;
    font-size: 13px;
}

th {
    background: #dbe5ff;
}

input.producto {
    width: 95%;
    border: none;
    text-align: center;
}

.totales {
    width: 300px;
    float: right;
    margin-top: 20px;
}

button {
    margin-top: 20px;
    padding: 8px 15px;
    background: #1c3faa;
    color: white;
    border: none;
    cursor: pointer;
}

@media print {
    .no-print {
        display: none;
    }
}
</style>
</head>

<body>

<div class="factura" id="factura">

<div class="header">

<div style="width:150px; display:flex; align-items:center;">
<img src="https://i.postimg.cc/QCpjhxQZ/logo.png" style="height:120px;">
</div>

<div class="titulo">
<h1>CITAR FERRETERA</h1>
<p>NIT: 1.078.918.733-6</p>
<p>Quibd贸, Choc贸</p>
</div>

<div class="tipo-doc">
<label><input type="checkbox"> Cotizaci贸n</label>
<label><input type="checkbox"> Remisi贸n</label>
<div class="numero">
No. <input type="number" id="numeroFactura" value="1">
</div>
</div>

</div>

<div class="info">

<div>
<div class="campo">
<label>Cotizado a:</label>
<input type="text" id="cliente">
</div>

<div class="campo">
<label>Direcci贸n:</label>
<input type="text" id="direccion">
</div>
</div>

<div>
<div class="campo">
<label>Fecha:</label>
<input type="date" id="fecha">
</div>

<div class="campo">
<label>C.C. 贸 NIT:</label>
<input type="text" id="nit">
</div>
</div>

</div>

<table>
<thead>
<tr>
<th style="width:10%;">CANT</th>
<th style="width:50%;">DESCRIPCIN</th>
<th style="width:20%;">Vr. UNITARIO</th>
<th style="width:20%;">Vr. TOTAL</th>
</tr>
</thead>
<tbody id="tablaProductos"></tbody>
</table>

<table class="totales">
<tr>
<td>SUBTOTAL</td>
<td>$<span id="subtotal"></span></td>
</tr>

<tr id="filaIVA">
<td>IVA (<input type="number" id="ivaInput" value="19"
style="width:50px;border:none;border-bottom:1px solid black;text-align:center;"
oninput="recalcularTotales()">%)</td>
<td>$<span id="iva"></span></td>
</tr>

<tr>
<td><strong>TOTAL</strong></td>
<td><strong>$<span id="totalFinal"></span></strong></td>
</tr>
</table>

<button class="no-print" onclick="generarPDF()">Descargar PDF</button>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>

let tabla = document.getElementById("tablaProductos");

//  18 FILAS FIJAS
for (let i = 0; i < 18; i++) {

tabla.innerHTML += `
<tr>
<td><input type="number" class="producto cantidad" oninput="calcular(this)"></td>
<td><input type="text" class="producto descripcion" oninput="calcular(this)"></td>
<td><input type="number" class="producto precio" oninput="calcular(this)"></td>
<td><span class="totalProducto"></span></td>
</tr>`;
}

function calcular(input) {

let fila = input.closest("tr");
let cantidad = parseFloat(fila.querySelector(".cantidad").value) || 0;
let precio = parseFloat(fila.querySelector(".precio").value) || 0;

let total = cantidad * precio;
fila.querySelector(".totalProducto").innerText = total > 0 ? total : "";

recalcularTotales();
}

function recalcularTotales() {

let subtotal = 0;

document.querySelectorAll("#tablaProductos tr").forEach(fila => {
let cantidad = parseFloat(fila.querySelector(".cantidad").value) || 0;
let precio = parseFloat(fila.querySelector(".precio").value) || 0;
subtotal += cantidad * precio;
});

document.getElementById("subtotal").innerText = subtotal || "";

let porcentaje = parseFloat(document.getElementById("ivaInput").value) || 0;

if (subtotal > 0 && porcentaje > 0) {
let iva = subtotal * (porcentaje / 100);
document.getElementById("iva").innerText = iva.toFixed(0);
document.getElementById("totalFinal").innerText = (subtotal + iva).toFixed(0);
} else {
document.getElementById("iva").innerText = "";
document.getElementById("totalFinal").innerText = subtotal.toFixed(0) || "";
}
}

async function generarPDF() {

const boton = document.querySelector(".no-print");
boton.style.display = "none";

const { jsPDF } = window.jspdf;
const factura = document.getElementById("factura");

const canvas = await html2canvas(factura);
const imgData = canvas.toDataURL("image/png");

const pdf = new jsPDF("p", "mm", "a4");
const width = pdf.internal.pageSize.getWidth();
const height = (canvas.height * width) / canvas.width;

pdf.addImage(imgData, "PNG", 0, 5, width, height);
pdf.save("factura.pdf");

boton.style.display = "inline-block";
}

</script>

</body>
</html>
